<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=768px, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Sigma Chi Beta Omega - Philanthropy</title>

    <link href="assets/css/skeleton.min.css" rel="stylesheet" type="text/css" />
    <link href="assets/css/style.2018.css" rel="stylesheet" type="text/css" />
    <style>
        html {
            background-color: #2A2829;
            background-image: url("assets/img/pattern-2018.png");
        }

        body {
            color: #E1E7EE;
        }

        a {
            text-decoration: none;
            color: #83829D;
        }

        a:hover {
            color: #63637A;
        }
    </style>

    <!-- Load Stripe Payment processing -->
    <script src="https://checkout.stripe.com/checkout.js"></script>
</head>

<body>
    <div class="container">
        <section id="navigation">
            <center>
                <a href="index.html">
                    <img height="200px" src="assets/img/derby-header-2018.png">
                </a>
            </center>
            <nav>
                <center>
                    <ul class="inline">
                        <li>
                            <header>Sigma Chi Beta Omega - Philanthropy</header>
                        </li>
                    </ul>
                </center>
            </nav>
        </section>

        <section>

            <p>Based in the the beautiful Salt Lake City, Utah, the Huntsman Cancer Institute (HCI) is an NCI-designated cancer
                research facility founded by John Huntsman Sr., a Sigma Chi alumnus. The Huntsman Cancer Institute’s mission
                statement is “to understand cancer from its beginnings, to use that knowledge in the creation and improvement
                of cancer treatments, to relieve the suffering of cancer patients, and to provide education about cancer
                risk, prevention, and care”.
            </p>
            <p>The HCI looks to provide hope to those affected by, or are currently suffering from cancer through their research,
                education, and state of the art care.
                <b>100%</b> of all proceeds go directly to the research facility. This year, the Beta Omega chapter is committed
                to raising $20,000 in funds for the Huntsman Cancer Institute.</p>
            <p>Help us reach our goal through a small donation and be part of the generation to end cancer.</p>

            <center>
                <a href="https://www.facebook.com/events/2011630112426139/" class="button">Event Page</a>
            </center>
        </section>

        <section id="donate">
            <header>Donate Now</header>

            <p>Donating to the cause is simple! Fill out the form below and be sure to include your team if you are in one.
                You will recieve a confrimation e-mail once your donation has been processed!</p>
            <p>Donation processing is made possible by the secure infrastructure provided by
                <a href="https://stripe.com">Stripe Payments</a>.</p>

            <form id="donate-form" action="https://wt-f85f3bf3160461738f82ec515dee4d4d-0.run.webtask.io/donate" method="POST">

                <!-- Personal details -->
                <div style="display: flex">
                    <input style="flex: 98" name="fullName" type="text" placeholder="Full Name" required="true">
                </div>

                <!-- Team details -->
                <div style="display: flex">
                    <select id="stripe-team" name="team" style="flex: 98" required="true">
                        <option value="none" selected>No Team</option>
                    </select>
                    <div style="flex: 2"></div>
                    <select id="stripe-amount" name="amount" style="flex: 98" required="true">
                        <option value="" selected disabled>Donation amount</option>
                        <option value="500">$5.00</option>
                        <option value="1000">$10.00</option>
                        <option value="1500">$15.00</option>
                        <option value="2000">$20.00</option>
                        <option value="2500">$25.00</option>
                        <option value="3000">$30.00</option>
                        <option value="3500">$35.00</option>
                        <option value="4000">$40.00</option>
                        <option value="4500">$45.00</option>
                        <option value="5000">$50.00</option>
                        <option value="7500">$75.00</option>
                        <option value="10000">$100.00</option>
                    </select>
                </div>

                <input id="stripeEmail" type="hidden" name="stripeEmail">
                <input id="stripeTokenInput" type="hidden" name="stripeToken">

                <center>
                    <button class="button" type="submit">Donate</button>
                </center>
            </form>
        </section>

        <section id="photos">
            <header>Photos</header>

            <ul id="og-grid" class="og-grid">
                <li>
                    <a onclick="openLightbox(this)" data-largesrc="assets/img/photos/original/2.jpg">
                        <img width="225px" height="auto" src="assets/img/photos/thumbs/2.jpg" />
                    </a>
                </li>
                <li>
                    <a onclick="openLightbox(this)" data-largesrc="assets/img/photos/original/3.jpg">
                        <img width="225px" height="auto" src="assets/img/photos/thumbs/3.jpg" />
                    </a>
                </li>
                <li>
                    <a onclick="openLightbox(this)" data-largesrc="assets/img/photos/original/4.jpg">
                        <img width="225px" height="auto" src="assets/img/photos/thumbs/4.jpg" />
                    </a>
                </li>
                <li>
                    <a onclick="openLightbox(this)" data-largesrc="assets/img/photos/original/5.jpg">
                        <img width="225px" height="auto" src="assets/img/photos/thumbs/5.jpg" />
                    </a>
                </li>
                <li>
                    <a onclick="openLightbox(this)" data-largesrc="assets/img/photos/original/6.jpg">
                        <img width="225px" height="auto" src="assets/img/photos/thumbs/6.jpg" />
                    </a>
                </li>
                <li>
                    <a onclick="openLightbox(this)" data-largesrc="assets/img/photos/original/7.jpg">
                        <img width="225px" height="auto" src="assets/img/photos/thumbs/7.jpg" />
                    </a>
                </li>
            </ul>
        </section>

        <section style="display: none">
            <header>Teams</header>

            <table id="team-table">
                <tr>
                    <th>Team</th>
                    <th>Amount Raised</th>
                    <th>Goal Amount</th>
                </tr>
            </table>
        </section>

        <section>
            <header>Philanthropy contacts</header>

            <table>
                <tr>
                    <th>Name</th>
                    <th>Phone Number</th>
                    <th>Email</th>
                </tr>
                <tr>
                    <td>Ethan Bryant</td>
                    <td>TBA</td>
                    <td>philanthropy@sigmachitoronto.com</td>
                </tr>
                <tr>
                    <td>Tylar Thompson</td>
                    <td>TBA</td>
                    <td>consul@sigmachitoronto.com</td>
                </tr>
            </table>
        </section>

        <br>
        <br>
    </div>

    <div id="lightbox">
        <div class="container lightbox-container">
            <a href="#photos">
                <img height="40px" width="40px" src="assets/img/close.png" />
            </a>
            <div id="lightbox-img"></div>
        </div>
    </div>
    <script>
        var lightboxImg = null

        window.onload = () => {
            // Initalize the lightbox.
            if (!lightboxImg) {
                lightboxImg = document.getElementById("lightbox-img")
            }

            parseURI()

            renderTeams()

            initializeStripe()
        }

        function parseURI() {
            // Fix for refreshing on lightbox page, return to photos tab.
            if (window.location.hash === '#lightbox' && !lightboxImg.hasAttribute('style')) {
                window.location.hash = 'photos'
            }

            // Parse the stripe status.
            var url = new URL(window.location.href)
            var stripeStatus = url.searchParams.get('stripe_status')
            var stripeMessage = decodeURIComponent(url.searchParams.get('message'))
            if (stripeStatus) {
                console.log("stripe_status: " + stripeStatus)

                var alertMessage = 'An error ocurred while confirming your payment. If the donation completed successfully you should recieve an email shorty.'
                var location = window.location.origin + window.location.pathname

                switch (stripeStatus) {
                    case '1':
                        alertMessage = 'The donation form is missing or contains invalid entires. Please try again.'
                        location += "#donate"
                        break;
                    case '2':
                        alertMessage = 'Please select a donation amount of at least $5.00.'
                        location += "#donate"
                        break;
                    case '5':
                        alertMessage = 'Our payment processor was unable to validate the payment method. Please try again later.'
                        location += "#donate"
                        break;
                    case '42':
                        alertMessage = 'Thank you for your donation. You should recieve an email confirmation shortly.'
                        break;
                    default:
                        console.log('Entered default scenario with code: ' + stripeStatus)
                        break;
                }

                window.location.href = location
                alert(alertMessage)
            }
        }

        function renderTeams() {
            var teamData = {
                "Alpha Gamma Delta": {
                    "url": "http://utoronto.alphagammadelta.org/",
                    "page": "#",
                    "raised": 0.00,
                    "goal": 0.00
                },
                "Alpha Omicron Pi": {
                    "url": "http://utoronto.alphaomicronpi.org/",
                    "page": "#",
                    "raised": 0.00,
                    "goal": 0.00
                },
                "Alpha Phi": {
                    "url": "http://alphaphialumto.com/",
                    "page": "#",
                    "raised": 0.00,
                    "goal": 0.00
                },
                "Gamma Phi Beta": {
                    "url": "https://www.gammaphibetatoronto.com/",
                    "page": "#",
                    "raised": 0.00,
                    "goal": 0.00
                },
                "Delta Delta Delta": {
                    "url": "http://utoronto.tridelta.org/",
                    "page": "#",
                    "raised": 0.00,
                    "goal": 0.00
                },
                "Kappa Kappa Gamma": {
                    "url": "http://utoronto.kappa.org/",
                    "page": "#",
                    "raised": 0.00,
                    "goal": 0.00
                },
                "Pi Beta Phi": {
                    "url": "https://www.pibetaphi.org/pibetaphi/utoronto",
                    "page": "#",
                    "raised": 0.00,
                    "goal": 0.00
                },
                "Delta Alpha Theta": {
                    "url": "http://deltaalphatheta.wixsite.com/gamma",
                    "page": "https://us-p2p.netdonor.net/223/derby-challenge/13806/matthews-derby-challenge",
                    "raised": 0.00,
                    "goal": 500.00
                },
                "Delta Psi Delta": {
                    "url": "http://deltapsideltatoronto.wixsite.com/gammachapter",
                    "page": "#",
                    "raised": 0.00,
                    "goal": 0.00
                },
                "Delta Phi Nu": {
                    "url": "https://deltaphinutoronto.wixsite.com/sigmatau",
                    "page": "#",
                    "raised": 0.00,
                    "goal": 0.00
                },
                "Delta Pi": {
                    "url": "http://www.deltapisorority.org/alpha_chapter-toronto",
                    "page": "#",
                    "raised": 0.00,
                    "goal": 0.00
                }
            }

            var teamTable = document.getElementById("team-table")
            var stripeTeamSelector = document.getElementById("stripe-team")

            for (name in teamData) {
                var team = teamData[name]

                var item = document.createElement("tr")
                item.innerHTML = '<td><a href="' + team.url + '">' + name + '</a></td>' +
                    '<td>$' + team.raised + '</td>' +
                    '<td>$' + team.goal + '</td>'

                teamTable.appendChild(item)

                var opt = document.createElement('option')
                opt.setAttribute('value', name)
                opt.innerText = name
                stripeTeamSelector.appendChild(opt)
            }

            var stripeAmountSelector = document.getElementById("stripe-amount")
            var initialAmount = 100

            for (i = 1; i < 37; i++) {
                var newAmount = initialAmount + (25 * i)

                var opt2 = document.createElement('option')
                opt2.setAttribute('value', newAmount * 100)
                opt2.innerText = '$' + newAmount + '.00'
                stripeAmountSelector.appendChild(opt2)
            }
        }

        function initializeStripe() {
            var donateForm = document.getElementById('donate-form')

            var handler = StripeCheckout.configure({
                // key: 'pk_test_h1E4eaur9kFOJiX02CZpyTQu', // Test Key
                key: 'pk_live_82uSQoNIrzd1010fW1W2rXFI',
                locale: 'auto',
                name: 'Sigma Chi Toronto',
                description: 'One-time donation',
                token: function (token) {
                    document.getElementById('stripeTokenInput').setAttribute('value', token.id)
                    document.getElementById('stripeEmail').setAttribute('value', token.email)
                    donateForm.submit()
                }
            });

            donateForm.addEventListener('submit', function (event) {
                event.preventDefault()

                try {
                    var amountSelector = document.getElementById('stripe-amount')

                    var donateAmount = parseFloat(amountSelector.options[amountSelector.selectedIndex].value)

                    handler.open({
                        'amount': donateAmount,
                        'allow-remember-me': false,
                        'panel-label': 'Donate - {{amount}}'
                    })
                } catch (err) {
                    alert("Unable to properly parse donation amount. Refresh the page and try again.")
                }
            })
        }

        function openLightbox(element) {
            var imgUrl = element.getAttribute("data-largesrc")

            lightboxImg.setAttribute("style", "background-image: url(" + imgUrl + ");")

            window.location.hash = "lightbox"
        }
    </script>
</body>

</html>